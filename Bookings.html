
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binge Leisure Resort | Bookings & Accounting Dashboard</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <style>
        :root {
            --primary-color: #BC8A5F;
            --secondary-color: #3D5A5B;
            --accent-color: #A52A2A;
            --light-color: #F7F3EE;
            --dark-color: #1A1A1A;
            --text-color: #333333;
            --text-light: #666666;
            --revenue-color: #28a745;
            --expense-color: #dc3545;
            --profit-color: #17a2b8;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            color: var(--text-color);
            padding-top: 20px;
            background-color: #f9f9f9;
        }
        
        h1, h2, h3, h4, h5 {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 600;
        }
        
        .booking-form {
            background-color: white;
            border-radius: 15px;
            padding: 2.5rem;
            box-shadow: 0 5px 25px rgba(0,0,0,0.08);
            margin-bottom: 40px;
        }
        
        .bookings-table {
            margin-top: 40px;
        }
        
        .table-responsive {
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .table thead {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .form-label {
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 8px;
        }
        
        .form-control, .form-select {
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(188, 138, 95, 0.25);
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            padding: 14px 30px;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(188, 138, 95, 0.3);
        }
        
        .btn-success {
            background-color: var(--revenue-color);
            border-color: var(--revenue-color);
        }
        
        .btn-danger {
            background-color: var(--expense-color);
            border-color: var(--expense-color);
        }
        
        .price-display {
            background-color: var(--light-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border-left: 4px solid var(--primary-color);
        }
        
        .total-price {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .feature-icon {
            font-size: 24px;
            color: var(--primary-color);
            margin-right: 10px;
        }
        
        .file-upload-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-upload-container:hover {
            border-color: var(--primary-color);
            background-color: rgba(188, 138, 95, 0.05);
        }
        
        .file-upload-container.active {
            border-color: var(--primary-color);
            background-color: rgba(188, 138, 95, 0.1);
        }
        
        .file-preview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
            display: none;
        }
        
        .upload-status {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }
        
        .progress {
            height: 8px;
            margin-top: 10px;
            display: none;
        }
        
        .room-option {
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .room-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(188, 138, 95, 0.05);
        }
        
        .room-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(188, 138, 95, 0.1);
        }
        
        .room-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .resort-header {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 40px 0;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.85rem;
        }
        
        .status-confirmed {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-cancelled {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .status-paid {
            background-color: #cce5ff;
            color: #004085;
        }
        
        .status-expense {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .dining-option {
            border-left: 4px solid var(--secondary-color);
            padding-left: 15px;
            margin-bottom: 20px;
        }
        
        /* Accounting Dashboard Styles */
        .accounting-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .summary-card {
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 15px;
            transition: transform 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
        }
        
        .summary-card.total-revenue {
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border: 1px solid #c3e6cb;
        }
        
        .summary-card.paid-revenue {
            background: linear-gradient(135deg, #cce5ff, #b8daff);
            border: 1px solid #b8daff;
        }
        
        .summary-card.expenses {
            background: linear-gradient(135deg, #f8d7da, #f5c6cb);
            border: 1px solid #f5c6cb;
        }
        
        .summary-card.net-profit {
            background: linear-gradient(135deg, #d1ecf1, #bee5eb);
            border: 1px solid #bee5eb;
        }
        
        .summary-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .summary-title {
            font-size: 1rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .expense-row {
            background-color: rgba(220, 53, 69, 0.05);
        }
        
        .expense-row td {
            color: var(--expense-color);
            font-weight: 600;
        }
        
        .revenue-row td {
            color: var(--revenue-color);
            font-weight: 600;
        }
        
        .amount-positive {
            color: var(--revenue-color);
            font-weight: 600;
        }
        
        .amount-negative {
            color: var(--expense-color);
            font-weight: 600;
        }
        
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .modal-header {
            background-color: var(--secondary-color);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 20px 30px;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .badge-category {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .badge-salary { background-color: #ffc107; color: #000; }
        .badge-utilities { background-color: #17a2b8; color: white; }
        .badge-food { background-color: #28a745; color: white; }
        .badge-beverages { background-color: #007bff; color: white; }
        .badge-entertainment { background-color: #6f42c1; color: white; }
        .badge-marketing { background-color: #e83e8c; color: white; }
        .badge-maintenance { background-color: #fd7e14; color: white; }
        .badge-other { background-color: #6c757d; color: white; }
        
        .uploaded-file {
            max-width: 100px;
            max-height: 100px;
            margin: 5px;
            border-radius: 5px;
        }
        
        .transaction-type-booking {
            background-color: rgba(40, 167, 69, 0.1);
        }
        
        .transaction-type-expense {
            background-color: rgba(220, 53, 69, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-12">
                <!-- Resort Header -->
                <div class="resort-header text-center">
                    <h1 class="display-4 mb-3">Binge Leisure Resort</h1>
                    <p class="lead mb-0">Booking & Accounting Management Dashboard</p>
                </div>
                
                <!-- Accounting Summary Dashboard -->
                <div class="accounting-summary">
                    <div class="dashboard-header">
                        <h2><i class="fas fa-chart-line feature-icon"></i> Financial Overview</h2>
                        <div class="action-buttons">
                            <button class="btn btn-danger" id="addExpenseBtn">
                                <i class="fas fa-plus-circle"></i> Add Expense
                            </button>
                            <button class="btn btn-success" onclick="location.href='#bookingForm'">
                                <i class="fas fa-plus"></i> New Booking
                            </button>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="summary-card total-revenue">
                                <div class="summary-title">Total Bookings Value</div>
                                <div class="summary-value" id="totalBookingsAmount">R0.00</div>
                                <div class="summary-subtitle" id="totalBookingsCount">0 Bookings</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-card paid-revenue">
                                <div class="summary-title">Paid Revenue</div>
                                <div class="summary-value" id="paidRevenueAmount">R0.00</div>
                                <div class="summary-subtitle" id="paidBookingsCount">0 Paid</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-card expenses">
                                <div class="summary-title">Total Expenses</div>
                                <div class="summary-value" id="totalExpensesAmount">R0.00</div>
                                <div class="summary-subtitle" id="expensesCount">0 Expenses</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="summary-card net-profit">
                                <div class="summary-title">Net Profit</div>
                                <div class="summary-value" id="netProfitAmount">R0.00</div>
                                <div class="summary-subtitle" id="profitMargin">0% Margin</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Booking Form -->
                <div class="booking-form" id="bookingFormSection">
                    <h2 class="mb-4">Make a Reservation</h2>
                    <form id="bookingForm">
                        <!-- Personal Information -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="firstName" class="form-label">First Name *</label>
                                <input type="text" class="form-control" id="firstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="lastName" class="form-label">Last Name *</label>
                                <input type="text" class="form-control" id="lastName" required>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="email" class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="phone" class="form-label">Phone Number *</label>
                                <input type="tel" class="form-control" id="phone" required>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="idNumber" class="form-label">ID/Passport Number</label>
                                <input type="text" class="form-control" id="idNumber">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="nationality" class="form-label">Nationality</label>
                                <input type="text" class="form-control" id="nationality" value="South African">
                            </div>
                        </div>
                        
                        <!-- Accommodation Selection -->
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="fas fa-bed feature-icon"></i> Select Accommodation</h4>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="room-option" data-room-type="treetop-villa" data-price="1200">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="roomType" id="treetopVilla" value="treetop-villa">
                                            <label class="form-check-label" for="treetopVilla">
                                                <strong>Treetop Villa</strong>
                                            </label>
                                        </div>
                                        <p class="mb-1">Private balcony with dam views</p>
                                        <p class="mb-1">King bed, ensuite bathroom</p>
                                        <p class="mb-2">Sleeps: 2 adults</p>
                                        <div class="room-price">R1,200 / night</div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="room-option" data-room-type="waterfront-suite" data-price="2500">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="roomType" id="waterfrontSuite" value="waterfront-suite">
                                            <label class="form-check-label" for="waterfrontSuite">
                                                <strong>Waterfront Suite</strong>
                                            </label>
                                        </div>
                                        <p class="mb-1">Direct dam access, private dock</p>
                                        <p class="mb-1">Infinity pool, butler service</p>
                                        <p class="mb-2">Sleeps: 2 adults, 2 children</p>
                                        <div class="room-price">R2,500 / night</div>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <div class="room-option" data-room-type="executive-residence" data-price="5000">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="roomType" id="executiveResidence" value="executive-residence">
                                            <label class="form-check-label" for="executiveResidence">
                                                <strong>Executive Residence</strong>
                                            </label>
                                        </div>
                                        <p class="mb-1">Private chef, helicopter pad</p>
                                        <p class="mb-1">3 bedrooms, dedicated concierge</p>
                                        <p class="mb-2">Sleeps: 6 guests</p>
                                        <div class="room-price">R5,000 / night</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Stay Duration -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="stayDuration" class="form-label">Stay Duration *</label>
                                <select class="form-select" id="stayDuration" required>
                                    <option value="">Select duration</option>
                                    <option value="1">1 Day/Night</option>
                                    <option value="2">2 Days/Nights</option>
                                    <option value="3">3 Days/Nights</option>
                                    <option value="4">4 Days/Nights</option>
                                    <option value="5">5 Days/Nights</option>
                                    <option value="7">7 Days/Nights (Week)</option>
                                    <option value="14">14 Days/Nights (Fortnight)</option>
                                </select>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="guestCount" class="form-label">Number of Guests *</label>
                                <select class="form-select" id="guestCount" required>
                                    <option value="">Select guests</option>
                                    <option value="1">1 Guest</option>
                                    <option value="2">2 Guests</option>
                                    <option value="3">3 Guests</option>
                                    <option value="4">4 Guests</option>
                                    <option value="5">5 Guests</option>
                                    <option value="6">6 Guests</option>
                                    <option value="7">7+ Guests (Contact us)</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Dates -->
                        <div class="row mb-4">
                            <div class="col-md-6 mb-3">
                                <label for="checkinDate" class="form-label">Check-in Date *</label>
                                <input type="date" class="form-control" id="checkinDate" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="checkoutDate" class="form-label">Check-out Date *</label>
                                <input type="date" class="form-control" id="checkoutDate" required>
                            </div>
                        </div>
                        
                        <!-- Raised Dining Experience -->
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="fas fa-arrow-up feature-icon"></i> 40-Foot Raised Dining Experience</h4>
                            <div class="dining-option">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="includeDining" value="true">
                                    <label class="form-check-label" for="includeDining">
                                        <strong>Include Raised Dining Experience</strong>
                                    </label>
                                </div>
                                <p class="mb-2">Enjoy gourmet meals 40 feet above ground with panoramic views. Additional R850 per person.</p>
                                
                                <div class="row mt-3" id="diningDetails" style="display: none;">
                                    <div class="col-md-6 mb-3">
                                        <label for="diningDate" class="form-label">Preferred Dining Date</label>
                                        <input type="date" class="form-control" id="diningDate">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="diningGuests" class="form-label">Number of Dining Guests</label>
                                        <select class="form-select" id="diningGuests">
                                            <option value="1">1 Guest</option>
                                            <option value="2" selected>2 Guests</option>
                                            <option value="3">3 Guests</option>
                                            <option value="4">4 Guests</option>
                                            <option value="5">5 Guests</option>
                                            <option value="6">6 Guests</option>
                                        </select>
                                    </div>
                                    <div class="col-md-12 mb-3">
                                        <label for="diningTime" class="form-label">Preferred Dining Time</label>
                                        <select class="form-select" id="diningTime">
                                            <option value="18:00">18:00 - Sunset Dinner</option>
                                            <option value="19:00">19:00 - Evening Dining</option>
                                            <option value="20:00">20:00 - Late Evening</option>
                                            <option value="12:00">12:00 - Lunch</option>
                                            <option value="08:00">08:00 - Breakfast</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Additional Services -->
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="fas fa-concierge-bell feature-icon"></i> Additional Services</h4>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="airportTransfer" value="true">
                                        <label class="form-check-label" for="airportTransfer">
                                            Airport Transfer (R450 each way)
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="spaTreatment" value="true">
                                        <label class="form-check-label" for="spaTreatment">
                                            Spa Treatment Package (R1,200)
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="damActivities" value="true">
                                        <label class="form-check-label" for="damActivities">
                                            Dam Activities Package (R800)
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="performanceTickets" value="true">
                                        <label class="form-check-label" for="performanceTickets">
                                            Performance Tickets (R300 per person)
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Special Requests & ID Upload -->
                        <div class="row mb-4">
                            <div class="col-md-12 mb-3">
                                <label for="specialRequests" class="form-label">Special Requests</label>
                                <textarea class="form-control" id="specialRequests" rows="3" placeholder="Any special requests or requirements..."></textarea>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="mb-3"><i class="fas fa-file-upload feature-icon"></i> Upload ID Document</h4>
                            <div class="file-upload-container" id="idUploadContainer">
                                <i class="fas fa-cloud-upload-alt fa-2x text-muted mb-3"></i>
                                <p class="mb-2">Click to upload ID/Passport document</p>
                                <p class="text-muted small mb-0">Supported files: PDF, JPG, PNG (Max 5MB)</p>
                                <input type="file" class="d-none" id="idDocument" accept=".pdf,.jpg,.jpeg,.png">
                            </div>
                            <div class="upload-status" id="idUploadStatus">No file selected</div>
                            <div class="progress" id="idUploadProgress">
                                <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                            <img src="" id="idPreview" class="file-preview" alt="ID Preview">
                        </div>
                        
                        <!-- Price Calculation -->
                        <div class="price-display">
                            <h4 class="mb-3">Booking Summary</h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <p>Accommodation: <span id="accommodationCost">R0</span></p>
                                    <p>Raised Dining: <span id="diningCost">R0</span></p>
                                    <p>Additional Services: <span id="servicesCost">R0</span></p>
                                </div>
                                <div class="col-md-6 text-end">
                                    <h3 class="total-price" id="totalPrice">R0</h3>
                                    <p class="text-muted small">Total for your stay</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                <span id="submitText">Complete Booking</span>
                                <span id="submitSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display: none;"></span>
                            </button>
                            <p class="text-muted small mt-2 text-center">By booking, you agree to our <a href="#">Terms & Conditions</a> and <a href="#">Cancellation Policy</a>.</p>
                        </div>
                    </form>
                </div>
                
                <!-- Bookings & Transactions Table -->
                <div class="bookings-table">
                    <h3 class="mb-4"><i class="fas fa-list-alt feature-icon"></i> Bookings & Financial Transactions</h3>
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Type</th>
                                    <th>Description</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Date</th>
                                    <th>Documents</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bookingsTableBody">
                                <!-- Bookings will be loaded here -->
                                <tr id="loadingRow">
                                    <td colspan="9" class="text-center">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2">Loading bookings and expenses...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Expense Modal -->
    <div class="modal fade" id="expenseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-file-invoice-dollar me-2"></i> Add New Expense</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="expenseForm">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="expenseName" class="form-label">Expense Name *</label>
                                <input type="text" class="form-control" id="expenseName" placeholder="e.g., Monthly Staff Salary" required>
                            </div>
                            <div class="col-md-6">
                                <label for="expenseCategory" class="form-label">Category *</label>
                                <select class="form-select" id="expenseCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="salary">Salary & Wages</option>
                                    <option value="utilities">Water & Electricity</option>
                                    <option value="food">Food Supplies</option>
                                    <option value="beverages">Beverages & Bar Stock</option>
                                    <option value="entertainment">Concert Sound & Artists</option>
                                    <option value="marketing">Marketing & Advertising</option>
                                    <option value="maintenance">Maintenance & Repairs</option>
                                    <option value="other">Other Expenses</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="expenseAmount" class="form-label">Amount (R) *</label>
                                <input type="number" class="form-control" id="expenseAmount" min="0" step="0.01" placeholder="0.00" required>
                            </div>
                            <div class="col-md-6">
                                <label for="expenseDate" class="form-label">Date *</label>
                                <input type="date" class="form-control" id="expenseDate" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="expenseDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="expenseDescription" rows="3" placeholder="Detailed description of the expense..."></textarea>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="expenseVendor" class="form-label">Vendor/Supplier</label>
                                <input type="text" class="form-control" id="expenseVendor" placeholder="Company or individual name">
                            </div>
                            <div class="col-md-6">
                                <label for="expenseInvoice" class="form-label">Invoice/Reference Number</label>
                                <input type="text" class="form-control" id="expenseInvoice" placeholder="e.g., INV-2023-001">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="expenseNotes" class="form-label">Additional Notes</label>
                            <textarea class="form-control" id="expenseNotes" rows="2" placeholder="Any additional information..."></textarea>
                        </div>
                        
                        <div class="text-end mt-4">
                            <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-check-circle me-2"></i> Add Expense
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAxKSE5ehafOnwm5W9i3kqbGup8xQ9nHKI",
            authDomain: "abceducation-d0254.firebaseapp.com",
            databaseURL: "https://abceducation-d0254-default-rtdb.firebaseio.com",
            projectId: "abceducation-d0254",
            storageBucket: "abceducation-d0254.firebasestorage.app",
            messagingSenderId: "911901882839",
            appId: "1:911901882839:web:4ce293724f34ddc8c17392"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const storage = firebase.storage();

        // References to database nodes
        const bookingsRef = database.ref('resortBookings');
        const expensesRef = database.ref('resortExpenses');

        // File upload variables
        let idDocumentFile = null;
        let idDocumentUrl = '';
        
        // Arrays to store transactions
        let allTransactions = [];

        // Set minimum dates for check-in and check-out
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const formatDate = (date) => {
            return date.toISOString().split('T')[0];
        };
        
        // Initialize date fields
        document.getElementById('checkinDate').min = formatDate(today);
        document.getElementById('checkinDate').value = formatDate(today);
        document.getElementById('checkoutDate').min = formatDate(tomorrow);
        document.getElementById('checkoutDate').value = formatDate(tomorrow);
        document.getElementById('expenseDate').value = formatDate(today);
        document.getElementById('diningDate').value = formatDate(today);

        // Format currency
        function formatCurrency(amount) {
            return 'R' + amount.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        // Update dashboard summary
        function updateDashboardSummary() {
            const bookings = allTransactions.filter(t => t.type === 'booking');
            const expenses = allTransactions.filter(t => t.type === 'expense');
            const paidBookings = bookings.filter(b => b.status === 'Paid');
            
            // Calculate totals
            const totalBookingsAmount = bookings.reduce((sum, b) => sum + (b.totalAmount || b.amount || 0), 0);
            const paidRevenueAmount = paidBookings.reduce((sum, b) => sum + (b.totalAmount || b.amount || 0), 0);
            const totalExpensesAmount = expenses.reduce((sum, e) => sum + (e.amount || 0), 0);
            const netProfit = paidRevenueAmount - totalExpensesAmount;
            
            // Update UI
            document.getElementById('totalBookingsAmount').textContent = formatCurrency(totalBookingsAmount);
            document.getElementById('totalBookingsCount').textContent = `${bookings.length} Bookings`;
            document.getElementById('paidRevenueAmount').textContent = formatCurrency(paidRevenueAmount);
            document.getElementById('paidBookingsCount').textContent = `${paidBookings.length} Paid`;
            document.getElementById('totalExpensesAmount').textContent = formatCurrency(totalExpensesAmount);
            document.getElementById('expensesCount').textContent = `${expenses.length} Expenses`;
            document.getElementById('netProfitAmount').textContent = formatCurrency(netProfit);
            document.getElementById('profitMargin').textContent = paidRevenueAmount > 0 ? 
                `${((netProfit / paidRevenueAmount) * 100).toFixed(1)}% Margin` : '0% Margin';
            
            // Update profit color based on value
            const profitElement = document.getElementById('netProfitAmount');
            if (netProfit < 0) {
                profitElement.style.color = 'var(--expense-color)';
            } else {
                profitElement.style.color = 'var(--profit-color)';
            }
        }

        // Get category badge class
        function getCategoryBadgeClass(category) {
            const badgeClasses = {
                'salary': 'badge-salary',
                'utilities': 'badge-utilities',
                'food': 'badge-food',
                'beverages': 'badge-beverages',
                'entertainment': 'badge-entertainment',
                'marketing': 'badge-marketing',
                'maintenance': 'badge-maintenance',
                'other': 'badge-other'
            };
            return badgeClasses[category] || 'badge-other';
        }

        // Render transactions table
        function renderTransactionsTable() {
            const tableBody = document.getElementById('bookingsTableBody');
            const loadingRow = document.getElementById('loadingRow');
            
            if (allTransactions.length === 0) {
                if (loadingRow) loadingRow.style.display = 'table-row';
                return;
            }
            
            if (loadingRow) loadingRow.style.display = 'none';
            tableBody.innerHTML = '';
            
            // Sort by date (newest first)
            const sortedTransactions = [...allTransactions].sort((a, b) => 
                new Date(b.timestamp || b.date) - new Date(a.timestamp || a.date)
            );
            
            sortedTransactions.forEach(transaction => {
                const row = document.createElement('tr');
                row.className = transaction.type === 'expense' ? 'expense-row' : 'transaction-type-booking';
                
                // Determine status badge
                let statusBadge = '';
                if (transaction.type === 'expense') {
                    statusBadge = `<span class="status-badge status-expense">Expense</span>`;
                } else {
                    const badgeClass = transaction.status === 'Paid' ? 'status-paid' : 
                                     transaction.status === 'Confirmed' ? 'status-confirmed' : 'status-pending';
                    statusBadge = `<span class="status-badge ${badgeClass}">${transaction.status}</span>`;
                }
                
                // Determine category badge for expenses
                let categoryBadge = '';
                if (transaction.type === 'expense' && transaction.category) {
                    categoryBadge = `<span class="badge-category ${getCategoryBadgeClass(transaction.category)}">
                                        ${transaction.category.charAt(0).toUpperCase() + transaction.category.slice(1)}
                                    </span>`;
                }
                
                // Create document preview
                let documentPreview = '';
                if (transaction.idDocumentUrl) {
                    documentPreview = `<a href="${transaction.idDocumentUrl}" target="_blank" class="btn btn-sm btn-outline-secondary">
                                          <i class="fas fa-file-pdf"></i> View ID
                                       </a>`;
                } else {
                    documentPreview = '<span class="text-muted">No documents</span>';
                }
                
                // Get transaction description
                let description = '';
                if (transaction.type === 'expense') {
                    description = transaction.description || transaction.name || 'Expense';
                } else {
                    description = `${transaction.roomName || ''} - ${transaction.stayDuration || 0} nights`;
                }
                
                // Determine action buttons
                let actionButtons = '';
                if (transaction.type === 'expense') {
                    actionButtons = `<button class="btn btn-sm btn-outline-danger" onclick="deleteExpense('${transaction.id}')">
                                        <i class="fas fa-trash"></i>
                                    </button>`;
                } else {
                    if (transaction.status !== 'Paid') {
                        actionButtons = `
                            <button class="btn btn-sm btn-success" onclick="confirmPayment('${transaction.id}')">
                                <i class="fas fa-check-circle"></i> Confirm Payment
                            </button>`;
                    } else {
                        actionButtons = `<span class="text-muted">Paid</span>`;
                    }
                }
                
                // Get date for display
                let displayDate = '';
                if (transaction.type === 'expense') {
                    displayDate = new Date(transaction.date).toLocaleDateString();
                } else {
                    displayDate = new Date(transaction.timestamp).toLocaleDateString();
                }
                
                row.innerHTML = `
                    <td>${transaction.id || transaction.bookingId || 'N/A'}</td>
                    <td>${transaction.firstName ? `${transaction.firstName} ${transaction.lastName}` : transaction.name || 'N/A'}</td>
                    <td>
                        ${transaction.type === 'expense' ? 'Expense' : 'Booking'}
                        ${categoryBadge}
                    </td>
                    <td>${description}</td>
                    <td class="${transaction.type === 'expense' ? 'amount-negative' : 'amount-positive'}">
                        ${transaction.type === 'expense' ? '-' : '+'}${formatCurrency(transaction.totalAmount || transaction.amount || 0)}
                    </td>
                    <td>${statusBadge}</td>
                    <td>${displayDate}</td>
                    <td>${documentPreview}</td>
                    <td>${actionButtons}</td>
                `;
                
                tableBody.appendChild(row);
            });
            
            updateDashboardSummary();
        }

        // Load all transactions from Firebase
        function loadAllTransactions() {
            allTransactions = [];
            
            // Load bookings
            bookingsRef.on('value', (snapshot) => {
                const bookings = snapshot.val();
                const bookingArray = [];
                
                if (bookings) {
                    Object.entries(bookings).forEach(([key, booking]) => {
                        bookingArray.push({
                            ...booking,
                            id: key,
                            type: 'booking'
                        });
                    });
                }
                
                // Update allTransactions with bookings
                allTransactions = allTransactions.filter(t => t.type !== 'booking');
                allTransactions.push(...bookingArray);
                
                // Load expenses
                expensesRef.on('value', (expenseSnapshot) => {
                    const expenses = expenseSnapshot.val();
                    const expenseArray = [];
                    
                    if (expenses) {
                        Object.entries(expenses).forEach(([key, expense]) => {
                            expenseArray.push({
                                ...expense,
                                id: key,
                                type: 'expense',
                                status: 'Paid' // Expenses are always considered paid
                            });
                        });
                    }
                    
                    // Update allTransactions with expenses
                    allTransactions = allTransactions.filter(t => t.type !== 'expense');
                    allTransactions.push(...expenseArray);
                    
                    renderTransactionsTable();
                }, (error) => {
                    console.error("Error loading expenses:", error);
                    renderTransactionsTable();
                });
            }, (error) => {
                console.error("Error loading bookings:", error);
            });
        }

        // Confirm payment for a booking
        async function confirmPayment(bookingId) {
            try {
                await bookingsRef.child(bookingId).update({
                    status: 'Paid',
                    paymentDate: new Date().toISOString()
                });
                
                alert('Payment confirmed! Revenue has been updated.');
            } catch (error) {
                console.error('Error confirming payment:', error);
                alert('Error confirming payment. Please try again.');
            }
        }

        // Delete expense
        async function deleteExpense(expenseId) {
            if (confirm('Are you sure you want to delete this expense?')) {
                try {
                    await expensesRef.child(expenseId).remove();
                    alert('Expense deleted successfully!');
                } catch (error) {
                    console.error('Error deleting expense:', error);
                    alert('Error deleting expense. Please try again.');
                }
            }
        }

        // Add expense
        document.getElementById('expenseForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            try {
                const expenseData = {
                    name: document.getElementById('expenseName').value,
                    category: document.getElementById('expenseCategory').value,
                    amount: parseFloat(document.getElementById('expenseAmount').value),
                    date: document.getElementById('expenseDate').value || formatDate(today),
                    description: document.getElementById('expenseDescription').value,
                    vendor: document.getElementById('expenseVendor').value,
                    invoice: document.getElementById('expenseInvoice').value,
                    notes: document.getElementById('expenseNotes').value,
                    timestamp: new Date().toISOString(),
                    type: 'expense'
                };
                
                // Push to Firebase
                await expensesRef.push(expenseData);
                
                // Reset form and close modal
                document.getElementById('expenseForm').reset();
                document.getElementById('expenseDate').value = formatDate(today);
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('expenseModal'));
                modal.hide();
                
                alert('Expense added successfully!');
            } catch (error) {
                console.error('Error adding expense:', error);
                alert('Error adding expense. Please try again.');
            }
        });

        // Add expense button
        document.getElementById('addExpenseBtn').addEventListener('click', function() {
            // Set default date to today
            document.getElementById('expenseDate').value = formatDate(today);
            
            const expenseModal = new bootstrap.Modal(document.getElementById('expenseModal'));
            expenseModal.show();
        });

        // ========== EXISTING BOOKING FUNCTIONALITY ==========
        // Update checkout date based on stay duration
        document.getElementById('stayDuration').addEventListener('change', function() {
            const duration = parseInt(this.value);
            const checkinDate = new Date(document.getElementById('checkinDate').value);
            const checkoutDate = new Date(checkinDate);
            checkoutDate.setDate(checkoutDate.getDate() + duration);
            
            document.getElementById('checkoutDate').value = formatDate(checkoutDate);
            calculateTotal();
        });
        
        // Update check-out min date when check-in changes
        document.getElementById('checkinDate').addEventListener('change', function() {
            const checkinDate = new Date(this.value);
            const duration = parseInt(document.getElementById('stayDuration').value) || 1;
            const checkoutDate = new Date(checkinDate);
            checkoutDate.setDate(checkoutDate.getDate() + duration);
            
            document.getElementById('checkoutDate').min = formatDate(checkinDate);
            document.getElementById('checkoutDate').value = formatDate(checkoutDate);
            calculateTotal();
        });
        
        // Room selection styling
        document.querySelectorAll('.room-option').forEach(option => {
            option.addEventListener('click', function() {
                // Remove selected class from all options
                document.querySelectorAll('.room-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Add selected class to clicked option
                this.classList.add('selected');
                
                // Check the radio button inside
                const radioBtn = this.querySelector('.form-check-input');
                radioBtn.checked = true;
                
                calculateTotal();
            });
        });
        
        // Toggle dining details
        document.getElementById('includeDining').addEventListener('change', function() {
            const diningDetails = document.getElementById('diningDetails');
            if (this.checked) {
                diningDetails.style.display = 'block';
            } else {
                diningDetails.style.display = 'none';
            }
            calculateTotal();
        });
        
        // Update dining date to match check-in if not set
        document.getElementById('checkinDate').addEventListener('change', function() {
            const diningDate = document.getElementById('diningDate');
            if (!diningDate.value) {
                diningDate.value = this.value;
            }
        });
        
        // File upload setup
        document.getElementById('idUploadContainer').addEventListener('click', function() {
            document.getElementById('idDocument').click();
        });

        // Handle ID document selection
        document.getElementById('idDocument').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                idDocumentFile = file;
                document.getElementById('idUploadStatus').textContent = `Selected: ${file.name}`;
                document.getElementById('idUploadContainer').classList.add('active');
                
                // Show preview if image
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('idPreview');
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            }
        });

        // Upload file to Firebase Storage
        function uploadFile(file, path) {
            return new Promise((resolve, reject) => {
                const storageRef = storage.ref(path);
                const uploadTask = storageRef.put(file);
                
                uploadTask.on('state_changed',
                    (snapshot) => {
                        // Progress monitoring
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        document.getElementById('idUploadProgress').style.display = 'block';
                        document.getElementById('idUploadProgress').querySelector('.progress-bar').style.width = progress + '%';
                    },
                    (error) => {
                        reject(error);
                    },
                    () => {
                        uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                            resolve(downloadURL);
                        });
                    }
                );
            });
        }
        
        // Calculate total price
        function calculateTotal() {
            // Get selected room price
            const selectedRoom = document.querySelector('.room-option.selected');
            const roomPricePerNight = selectedRoom ? parseInt(selectedRoom.dataset.price) : 0;
            
            // Get stay duration
            const stayDuration = parseInt(document.getElementById('stayDuration').value) || 0;
            
            // Calculate accommodation cost
            const accommodationCost = roomPricePerNight * stayDuration;
            
            // Calculate dining cost
            let diningCost = 0;
            if (document.getElementById('includeDining').checked) {
                const diningGuests = parseInt(document.getElementById('diningGuests').value) || 2;
                diningCost = 850 * diningGuests;
            }
            
            // Calculate additional services cost
            let servicesCost = 0;
            if (document.getElementById('airportTransfer').checked) servicesCost += 900; // Both ways
            if (document.getElementById('spaTreatment').checked) servicesCost += 1200;
            if (document.getElementById('damActivities').checked) servicesCost += 800;
            if (document.getElementById('performanceTickets').checked) {
                const guestCount = parseInt(document.getElementById('guestCount').value) || 2;
                servicesCost += 300 * guestCount;
            }
            
            // Calculate total
            const totalCost = accommodationCost + diningCost + servicesCost;
            
            // Update display
            document.getElementById('accommodationCost').textContent = `R${accommodationCost.toLocaleString()}`;
            document.getElementById('diningCost').textContent = `R${diningCost.toLocaleString()}`;
            document.getElementById('servicesCost').textContent = `R${servicesCost.toLocaleString()}`;
            document.getElementById('totalPrice').textContent = `R${totalCost.toLocaleString()}`;
            
            return totalCost;
        }
        
        // Add event listeners for price calculation
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('change', calculateTotal);
        });
        
        // Initial calculation
        calculateTotal();

        // Form submission handler
        document.getElementById('bookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Disable submit button and show spinner
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const submitSpinner = document.getElementById('submitSpinner');
            
            submitBtn.disabled = true;
            submitText.textContent = 'Processing Booking...';
            submitSpinner.style.display = 'inline-block';
            
            try {
                // Get form values
                const firstName = document.getElementById('firstName').value;
                const lastName = document.getElementById('lastName').value;
                const email = document.getElementById('email').value;
                const phone = document.getElementById('phone').value;
                const idNumber = document.getElementById('idNumber').value;
                const nationality = document.getElementById('nationality').value;
                const roomType = document.querySelector('input[name="roomType"]:checked')?.value || '';
                const stayDuration = document.getElementById('stayDuration').value;
                const guestCount = document.getElementById('guestCount').value;
                const checkinDate = document.getElementById('checkinDate').value;
                const checkoutDate = document.getElementById('checkoutDate').value;
                const includeDining = document.getElementById('includeDining').checked;
                const diningDate = document.getElementById('diningDate').value;
                const diningGuests = document.getElementById('diningGuests').value;
                const diningTime = document.getElementById('diningTime').value;
                const airportTransfer = document.getElementById('airportTransfer').checked;
                const spaTreatment = document.getElementById('spaTreatment').checked;
                const damActivities = document.getElementById('damActivities').checked;
                const performanceTickets = document.getElementById('performanceTickets').checked;
                const specialRequests = document.getElementById('specialRequests').value;
                
                const timestamp = new Date().toISOString();
                const status = "Confirmed";
                const bookingId = 'BLR' + Date.now();
                
                // Get room name based on type
                let roomName = '';
                switch(roomType) {
                    case 'treetop-villa': roomName = 'Treetop Villa'; break;
                    case 'waterfront-suite': roomName = 'Waterfront Suite'; break;
                    case 'executive-residence': roomName = 'Executive Residence'; break;
                    default: roomName = 'Not Selected';
                }
                
                // Upload ID document if provided
                if (idDocumentFile) {
                    const idDocPath = `booking_documents/${bookingId}_${idDocumentFile.name}`;
                    idDocumentUrl = await uploadFile(idDocumentFile, idDocPath);
                }
                
                // Calculate total price
                const totalAmount = calculateTotal();
                
                // Create booking object
                const booking = {
                    bookingId,
                    firstName,
                    lastName,
                    email,
                    phone,
                    idNumber,
                    nationality,
                    roomType,
                    roomName,
                    stayDuration,
                    guestCount,
                    checkinDate,
                    checkoutDate,
                    includeDining,
                    diningDate: includeDining ? diningDate : '',
                    diningGuests: includeDining ? diningGuests : 0,
                    diningTime: includeDining ? diningTime : '',
                    airportTransfer,
                    spaTreatment,
                    damActivities,
                    performanceTickets,
                    specialRequests,
                    idDocumentUrl: idDocumentUrl || '',
                    timestamp,
                    status,
                    totalAmount,
                    type: 'booking'
                };
                
                // Push to Firebase
                await bookingsRef.push(booking);
                
                alert(`Booking confirmed! Your booking ID is: ${bookingId}\nA confirmation email has been sent to ${email}`);
                document.getElementById('bookingForm').reset();
                
                // Reset file upload
                document.getElementById('idPreview').style.display = 'none';
                document.getElementById('idUploadContainer').classList.remove('active');
                document.getElementById('idUploadStatus').textContent = 'No file selected';
                document.getElementById('idUploadProgress').style.display = 'none';
                
                // Reset file variables
                idDocumentFile = null;
                idDocumentUrl = '';
                
                // Reset dates
                document.getElementById('checkinDate').value = formatDate(today);
                document.getElementById('checkoutDate').value = formatDate(tomorrow);
                
                // Reset room selection
                document.querySelectorAll('.room-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Reset dining section
                document.getElementById('includeDining').checked = false;
                document.getElementById('diningDetails').style.display = 'none';
                
                // Recalculate total
                calculateTotal();
                
            } catch (error) {
                console.error('Error submitting booking: ', error);
                alert('Error submitting booking. Please try again.');
            } finally {
                // Re-enable submit button
                submitBtn.disabled = false;
                submitText.textContent = 'Complete Booking';
                submitSpinner.style.display = 'none';
            }
        });

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadAllTransactions();
        });
    </script>
</body>
</html>
